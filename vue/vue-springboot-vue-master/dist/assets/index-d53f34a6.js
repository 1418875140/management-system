import{a as c,c as k,k as m,d as Oe,r as p,J as I,S as je,o as qe,bc as Me,a4 as e,w as t,f as a,aq as H,aw as Pe,a2 as i,O as D,l as v,ak as Ae,Q as He,a5 as Ke,al as K,bd as Qe,a6 as g,be as Xe,bf as Ze,bg as Ge,bh as Je,bi as We,bj as Ye,bk as el,bl as ll,bm as tl,ay as ol,az as al,E as nl}from"./index-6e278e4c.js";import{_ as sl,e as il,f as dl,a as rl,b as ul,E as pl,c as cl,d as ml,v as _l}from"./search-cb33e234.js";import{E as fl}from"./el-icon-dff55afe.js";import{E as hl}from"./el-dialog-7225b063.js";import{E as gl,a as bl}from"./el-radio-86a5f7d7.js";import"./el-tooltip-fc220203.js";import{E as de}from"./el-tree-2d203f22.js";import{E as vl}from"./el-tree-select-36b1753f.js";import{a as wl,E as yl}from"./el-row-ec202fdb.js";import{_ as xl}from"./index-bcf158b7.js";import{E as Vl}from"./el-switch-7d200c5b.js";import{b as kl,E as El,a as Cl}from"./el-dropdown-item-cbbd96a1.js";import{_ as Ul}from"./plus-791a9653.js";/* empty css                */import{E as Q,a as Ll}from"./el-form-item-490b18bc.js";import{E as $l}from"./el-card-e6cdcab0.js";import{b as Rl}from"./index-5556a057.js";import{l as Il}from"./index-8e653ea9.js";import"./refs-4b7a3a14.js";import"./index-d06f9fa4.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./dropdown-13ad8af3.js";import"./castArray-5e585c79.js";const Dl={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},Bl=m("path",{fill:"currentColor",d:"M544 864V672h128L512 480L352 672h128v192H320v-1.6c-5.376.32-10.496 1.6-16 1.6A240 240 0 0 1 64 624c0-123.136 93.12-223.488 212.608-237.248A239.808 239.808 0 0 1 512 192a239.872 239.872 0 0 1 235.456 194.752c119.488 13.76 212.48 114.112 212.48 237.248a240 240 0 0 1-240 240c-5.376 0-10.56-1.28-16-1.6v1.6H544z"},null,-1),Tl=[Bl];function zl(B,w){return c(),k("svg",Dl,Tl)}const Fl={name:"ep-upload-filled",render:zl},Sl={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},Nl=m("path",{fill:"currentColor",d:"M289.088 296.704h92.992a32 32 0 0 1 0 64H232.96a32 32 0 0 1-32-32V179.712a32 32 0 0 1 64 0v50.56a384 384 0 0 1 643.84 282.88a384 384 0 0 1-383.936 384a384 384 0 0 1-384-384h64a320 320 0 1 0 640 0a320 320 0 0 0-555.712-216.448z"},null,-1),Ol=[Nl];function jl(B,w){return c(),k("svg",Sl,Ol)}const ql={name:"ep-refresh-left",render:jl},Ml={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},Pl=m("path",{fill:"currentColor",d:"M572.235 205.282v600.365a30.118 30.118 0 1 1-60.235 0V205.282L292.382 438.633a28.913 28.913 0 0 1-42.646 0a33.43 33.43 0 0 1 0-45.236l271.058-288.045a28.913 28.913 0 0 1 42.647 0L834.5 393.397a33.43 33.43 0 0 1 0 45.176a28.913 28.913 0 0 1-42.647 0l-219.618-233.23z"},null,-1),Al=[Pl];function Hl(B,w){return c(),k("svg",Ml,Al)}const Kl={name:"ep-top",render:Hl},Ql={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},Xl=m("path",{fill:"currentColor",d:"M160 832h704a32 32 0 1 1 0 64H160a32 32 0 1 1 0-64zm384-253.696l236.288-236.352l45.248 45.248L508.8 704L192 387.2l45.248-45.248L480 584.704V128h64v450.304z"},null,-1),Zl=[Xl];function Gl(B,w){return c(),k("svg",Ql,Zl)}const Jl={name:"ep-download",render:Gl},Wl={class:"app-container"},Yl={class:"search"},et={class:"flex justify-between"},lt={class:"dialog-footer"},tt=m("div",{class:"el-upload__text"},[i(" 将文件拖到此处，或 "),m("em",null,"点击上传")],-1),ot=m("div",{class:"el-upload__tip"},"xls/xlsx files",-1),at={class:"dialog-footer"},nt={name:"user"},$t=Oe({...nt,setup(B){const w=p(de),X=p(Q),T=p(Q),y=p(!1),O=p([]),E=p(0),b=I({visible:!1}),d=I({pageNum:1,pageSize:10}),Z=p(),s=I({status:1}),re=I({username:[{required:!0,message:"用户名不能为空",trigger:"blur"}],nickname:[{required:!0,message:"用户昵称不能为空",trigger:"blur"}],deptId:[{required:!0,message:"所属部门不能为空",trigger:"blur"}],roleIds:[{required:!0,message:"用户角色不能为空",trigger:"blur"}],email:[{pattern:/\w[-\w.+]*@([A-Za-z0-9][-A-Za-z0-9]+\.)+[A-Za-z]{2,14}/,message:"请输入正确的邮箱地址",trigger:"blur"}],mobile:[{pattern:/^1[3|4|5|6|7|8|9][0-9]\d{8}$/,message:"请输入正确的手机号码",trigger:"blur"}]}),z=p(),F=p(),G=p(),C=I({title:"用户导入",visible:!1}),U=p(0),L=p(),j=p([]);je(()=>{w.value.filter(z.value)},{flush:"post"});function ue(n,l){return n?l.label.indexOf(n)!==-1:!0}function pe(n){d.deptId=n.value,x()}async function J(){Il().then(n=>{G.value=n.data})}function ce(n){const l=n.status===1?"启用":"停用";K.confirm("确认要"+l+n.username+"用户吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>Qe(n.id,n.status)).then(()=>{g.success(l+"成功")}).catch(()=>{n.status=n.status===1?0:1})}function x(){y.value=!0,Xe(d).then(({data:n})=>{Z.value=n.list,E.value=n.total}).finally(()=>{y.value=!1})}function $(){X.value.resetFields(),d.pageNum=1,d.deptId=void 0,x()}function me(n){O.value=n.map(l=>l.id)}function _e(n){K.prompt("请输入用户「"+n.username+"」的新密码","重置密码",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(({value:l})=>{if(!l)return g.warning("请输入新密码"),!1;Ze(n.id,l).then(()=>{g.success("密码重置成功，新密码是："+l)})}).catch(()=>{})}async function W(n){await q(),await J(),b.visible=!0,n?(b.title="修改用户",Ge(n).then(({data:l})=>{Object.assign(s,l)})):b.title="新增用户"}function S(){b.visible=!1,fe()}function fe(){T.value.resetFields(),T.value.clearValidate(),s.id=void 0,s.status=1}function he(){T.value.validate(n=>{if(n){const l=s.id;y.value=!0,l?Je(l,s).then(()=>{g.success("修改用户成功"),S(),$()}).finally(()=>y.value=!1):We(s).then(()=>{g.success("新增用户成功"),S(),$()}).finally(()=>y.value=!1)}})}function Y(n){const l=[n||O.value].join(",");if(!l){g.warning("请勾选删除项");return}K.confirm("确认删除用户?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Ye(l).then(()=>{g.success("删除成功"),$()})})}async function q(){Rl().then(n=>{F.value=n.data})}function ge(){el().then(n=>{const l=new Blob([n.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=utf-8"}),r=document.createElement("a"),_=window.URL.createObjectURL(l);r.href=_,r.download=decodeURI(n.headers["content-disposition"].split(";")[1].split("=")[1]),document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(_)})}async function be(){await q(),await J(),C.visible=!0}function ve(n){if(!/\.(xlsx|xls|XLSX|XLS)$/.test(n.name))return g.warning("上传Excel只能为xlsx、xls格式"),L.value=void 0,j.value=[],!1;L.value=n.raw}function we(){if(U.value){if(!L.value)return g.warning("上传Excel文件不能为空"),!1;ll(U.value,L.value).then(n=>{g.success(n.data),M(),$()})}}function M(){C.visible=!1,L.value=void 0,j.value=[]}function ye(){tl(d).then(n=>{const l=new Blob([n.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=utf-8"}),r=document.createElement("a"),_=window.URL.createObjectURL(l);r.href=_,r.download=decodeURI(n.headers["content-disposition"].split(";")[1].split("=")[1]),document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(_)})}return qe(()=>{q(),x()}),(n,l)=>{const r=sl,_=ol,xe=de,ee=$l,le=wl,u=Ll,V=il,P=dl,f=al,Ve=rl,A=Q,ke=Ul,te=ul,oe=Jl,ae=kl,Ee=Kl,Ce=El,Ue=Cl,h=pl,Le=Vl,$e=ql,Re=cl,Ie=ml,De=xl,Be=yl,ne=vl,se=gl,Te=bl,ie=hl,ze=Fl,Fe=nl,Se=fl,N=Me("hasPerm"),Ne=_l;return c(),k("div",Wl,[e(Be,{gutter:20},{default:t(()=>[e(le,{lg:4,xs:24,class:"mb-[12px]"},{default:t(()=>[e(ee,{shadow:"never"},{default:t(()=>[e(_,{modelValue:a(z),"onUpdate:modelValue":l[0]||(l[0]=o=>H(z)?z.value=o:null),placeholder:"部门名称",clearable:""},{prefix:t(()=>[e(r)]),_:1},8,["modelValue"]),e(xe,{class:"mt-2",ref_key:"deptTreeRef",ref:w,data:a(F),props:{children:"children",label:"label",disabled:""},"expand-on-click-node":!1,"filter-node-method":ue,"default-expand-all":"",onNodeClick:pe},null,8,["data"])]),_:1})]),_:1}),e(le,{lg:20,xs:24},{default:t(()=>[m("div",Yl,[e(A,{ref_key:"queryFormRef",ref:X,model:a(d),inline:!0},{default:t(()=>[e(u,{label:"关键字",prop:"keywords"},{default:t(()=>[e(_,{modelValue:a(d).keywords,"onUpdate:modelValue":l[1]||(l[1]=o=>a(d).keywords=o),placeholder:"用户名/昵称/手机号",clearable:"",style:{width:"200px"},onKeyup:Pe(x,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),e(u,{label:"状态",prop:"status"},{default:t(()=>[e(P,{modelValue:a(d).status,"onUpdate:modelValue":l[2]||(l[2]=o=>a(d).status=o),placeholder:"全部",clearable:"",style:{width:"200px"}},{default:t(()=>[e(V,{label:"启用",value:"1"}),e(V,{label:"禁用",value:"0"})]),_:1},8,["modelValue"])]),_:1}),e(u,null,{default:t(()=>[e(f,{type:"primary",onClick:x},{default:t(()=>[e(r),i("搜索")]),_:1}),e(f,{onClick:$},{default:t(()=>[e(Ve),i(" 重置")]),_:1})]),_:1})]),_:1},8,["model"])]),e(ee,{shadow:"never"},{header:t(()=>[m("div",et,[m("div",null,[D((c(),v(f,{type:"success",onClick:l[3]||(l[3]=o=>W())},{default:t(()=>[e(ke),i("新增")]),_:1})),[[N,["sys:user:add"]]]),D((c(),v(f,{type:"danger",disabled:a(O).length===0,onClick:l[4]||(l[4]=o=>Y())},{default:t(()=>[e(te),i("删除")]),_:1},8,["disabled"])),[[N,["sys:user:delete"]]])]),m("div",null,[e(Ue,{"split-button":""},{dropdown:t(()=>[e(Ce,null,{default:t(()=>[e(ae,{onClick:ge},{default:t(()=>[e(oe),i("下载模板")]),_:1}),e(ae,{onClick:be},{default:t(()=>[e(Ee),i("导入数据")]),_:1})]),_:1})]),default:t(()=>[i(" 导入 ")]),_:1}),e(f,{class:"ml-3",onClick:ye},{icon:t(()=>[e(oe)]),default:t(()=>[i("导出")]),_:1})])])]),default:t(()=>[D((c(),v(Ie,{data:a(Z),onSelectionChange:me},{default:t(()=>[e(h,{type:"selection",width:"50",align:"center"}),e(h,{key:"id",label:"编号",align:"center",prop:"id",width:"100"}),e(h,{key:"username",label:"用户名",align:"center",prop:"username"}),e(h,{label:"用户昵称",width:"120",align:"center",prop:"nickname"}),e(h,{label:"性别",width:"100",align:"center",prop:"genderLabel"}),e(h,{label:"部门",width:"120",align:"center",prop:"deptName"}),e(h,{label:"手机号码",align:"center",prop:"mobile",width:"120"}),e(h,{label:"状态",align:"center",prop:"status"},{default:t(o=>[e(Le,{modelValue:o.row.status,"onUpdate:modelValue":R=>o.row.status=R,"inactive-value":0,"active-value":1,onChange:R=>ce(o.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(h,{label:"创建时间",align:"center",prop:"createTime",width:"180"}),e(h,{label:"操作",fixed:"right",width:"220"},{default:t(o=>[e(f,{type:"primary",size:"small",link:"",onClick:R=>_e(o.row)},{default:t(()=>[e($e),i("重置密码")]),_:2},1032,["onClick"]),D((c(),v(f,{type:"primary",link:"",size:"small",onClick:R=>W(o.row.id)},{default:t(()=>[e(Re),i("编辑")]),_:2},1032,["onClick"])),[[N,["sys:user:edit"]]]),D((c(),v(f,{type:"primary",link:"",size:"small",onClick:R=>Y(o.row.id)},{default:t(()=>[e(te),i("删除")]),_:2},1032,["onClick"])),[[N,["sys:user:delete"]]])]),_:1})]),_:1},8,["data"])),[[Ne,a(y)]]),a(E)>0?(c(),v(De,{key:0,total:a(E),"onUpdate:total":l[5]||(l[5]=o=>H(E)?E.value=o:null),page:a(d).pageNum,"onUpdate:page":l[6]||(l[6]=o=>a(d).pageNum=o),limit:a(d).pageSize,"onUpdate:limit":l[7]||(l[7]=o=>a(d).pageSize=o),onPagination:x},null,8,["total","page","limit"])):Ae("",!0)]),_:1})]),_:1})]),_:1}),e(ie,{title:a(b).title,modelValue:a(b).visible,"onUpdate:modelValue":l[16]||(l[16]=o=>a(b).visible=o),width:"600px","append-to-body":"",onClose:S},{footer:t(()=>[m("div",lt,[e(f,{type:"primary",onClick:he},{default:t(()=>[i("确 定")]),_:1}),e(f,{onClick:S},{default:t(()=>[i("取 消")]),_:1})])]),default:t(()=>[e(A,{ref_key:"userFormRef",ref:T,model:a(s),rules:a(re),"label-width":"80px"},{default:t(()=>[e(u,{label:"用户名",prop:"username"},{default:t(()=>[e(_,{readonly:!!a(s).id,modelValue:a(s).username,"onUpdate:modelValue":l[8]||(l[8]=o=>a(s).username=o),placeholder:"请输入用户名"},null,8,["readonly","modelValue"])]),_:1}),e(u,{label:"用户昵称",prop:"nickname"},{default:t(()=>[e(_,{modelValue:a(s).nickname,"onUpdate:modelValue":l[9]||(l[9]=o=>a(s).nickname=o),placeholder:"请输入用户昵称"},null,8,["modelValue"])]),_:1}),e(u,{label:"所属部门",prop:"deptId"},{default:t(()=>[e(ne,{modelValue:a(s).deptId,"onUpdate:modelValue":l[10]||(l[10]=o=>a(s).deptId=o),placeholder:"请选择所属部门",data:a(F),filterable:"","check-strictly":"","render-after-expand":!1},null,8,["modelValue","data"])]),_:1}),e(u,{label:"性别",prop:"gender"},{default:t(()=>[e(P,{modelValue:a(s).gender,"onUpdate:modelValue":l[11]||(l[11]=o=>a(s).gender=o),placeholder:"请选择"},{default:t(()=>[e(V,{label:"未知",value:0}),e(V,{label:"男",value:1}),e(V,{label:"女",value:2})]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"角色",prop:"roleIds"},{default:t(()=>[e(P,{modelValue:a(s).roleIds,"onUpdate:modelValue":l[12]||(l[12]=o=>a(s).roleIds=o),multiple:"",placeholder:"请选择"},{default:t(()=>[(c(!0),k(He,null,Ke(a(G),o=>(c(),v(V,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"手机号码",prop:"mobile"},{default:t(()=>[e(_,{modelValue:a(s).mobile,"onUpdate:modelValue":l[13]||(l[13]=o=>a(s).mobile=o),placeholder:"请输入手机号码",maxlength:"11"},null,8,["modelValue"])]),_:1}),e(u,{label:"邮箱",prop:"email"},{default:t(()=>[e(_,{modelValue:a(s).email,"onUpdate:modelValue":l[14]||(l[14]=o=>a(s).email=o),placeholder:"请输入邮箱",maxlength:"50"},null,8,["modelValue"])]),_:1}),e(u,{label:"状态",prop:"status"},{default:t(()=>[e(Te,{modelValue:a(s).status,"onUpdate:modelValue":l[15]||(l[15]=o=>a(s).status=o)},{default:t(()=>[e(se,{label:1},{default:t(()=>[i("正常")]),_:1}),e(se,{label:0},{default:t(()=>[i("禁用")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),e(ie,{title:a(C).title,modelValue:a(C).visible,"onUpdate:modelValue":l[18]||(l[18]=o=>a(C).visible=o),width:"600px","append-to-body":"",onClose:M},{footer:t(()=>[m("div",at,[e(f,{type:"primary",onClick:we},{default:t(()=>[i("确 定")]),_:1}),e(f,{onClick:M},{default:t(()=>[i("取 消")]),_:1})])]),default:t(()=>[e(A,{"label-width":"80px"},{default:t(()=>[e(u,{label:"部门"},{default:t(()=>[e(ne,{modelValue:a(U),"onUpdate:modelValue":l[17]||(l[17]=o=>H(U)?U.value=o:null),placeholder:"请选择部门",data:a(F),filterable:"","check-strictly":""},null,8,["modelValue","data"])]),_:1}),e(u,{label:"Excel"},{default:t(()=>[e(Se,{class:"upload-demo",action:"",drag:"","auto-upload":!1,accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel","file-list":a(j),"on-change":ve,limit:1},{tip:t(()=>[ot]),default:t(()=>[e(Fe,{class:"el-icon--upload"},{default:t(()=>[e(ze)]),_:1}),tt]),_:1},8,["file-list"])]),_:1})]),_:1})]),_:1},8,["title","modelValue"])])}}});export{$t as default};
