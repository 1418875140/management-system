import{a as d,c as A,k as S,d as ce,r as _,J as V,o as fe,a4 as e,w as t,f as a,aw as ge,a2 as i,O as Q,l as c,aq as G,ak as ve,t as be,a6 as w,al as ye,aO as ke,ay as he,az as Ve}from"./index-6e278e4c.js";import{_ as we,a as Ee,b as Ce,E as Re,g as xe,c as Se,d as Ue,e as Fe,f as Me,v as Ne}from"./search-cb33e234.js";import{a as ze}from"./el-tooltip-fc220203.js";import{E as J}from"./el-tree-2d203f22.js";import{E as Be}from"./el-dialog-7225b063.js";import{E as De}from"./el-input-number-eaf8393a.js";import{E as Ie,a as $e}from"./el-radio-86a5f7d7.js";import{E as qe}from"./el-card-e6cdcab0.js";import{_ as Te}from"./index-bcf158b7.js";import{_ as Le}from"./plus-791a9653.js";/* empty css                */import{E as z,a as Oe}from"./el-form-item-490b18bc.js";import{g as Ke,a as Pe,u as je,b as Qe,d as Ge,c as Je,e as Ae}from"./index-8e653ea9.js";import"./index-d06f9fa4.js";import"./refs-4b7a3a14.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./castArray-5e585c79.js";const He={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},We=S("path",{fill:"currentColor",d:"m249.6 417.088l319.744 43.072l39.168 310.272L845.12 178.88L249.6 417.088zm-129.024 47.168a32 32 0 0 1-7.68-61.44l777.792-311.04a32 32 0 0 1 41.6 41.6l-310.336 775.68a32 32 0 0 1-61.44-7.808L512 516.992l-391.424-52.736z"},null,-1),Xe=[We];function Ye(H,U){return d(),A("svg",He,Xe)}const Ze={name:"ep-position",render:Ye},el={class:"app-container"},ll={class:"search"},tl={class:"dialog-footer"},ol={class:"dialog-footer"},al={name:"role"},Vl=ce({...al,setup(H){const U=_(z),E=_(z),F=_(J),u=_(!1),M=_([]),y=_(0),p=V({pageNum:1,pageSize:10}),B=_(),g=V({visible:!1}),n=V({sort:1,status:1,code:"",name:""}),W=V({name:[{required:!0,message:"请输入角色名称",trigger:"blur"}],code:[{required:!0,message:"请输入角色编码",trigger:"blur"}],dataScope:[{required:!0,message:"请选择数据权限",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"blur"}]}),v=_(!1),D=_([]);let N=V({});function k(){u.value=!0,Ke(p).then(({data:s})=>{B.value=s.list,y.value=s.total}).finally(()=>{u.value=!1})}function h(){U.value.resetFields(),p.pageNum=1,k()}function X(s){M.value=s.map(l=>l.id)}function I(s){g.visible=!0,s?(g.title="修改角色",Pe(s).then(({data:l})=>{Object.assign(n,l)})):g.title="新增角色"}function Y(){u.value=!0,E.value.validate(s=>{if(s){const l=n.id;l?je(l,n).then(()=>{w.success("修改成功"),C(),h()}).finally(()=>u.value=!1):Qe(n).then(()=>{w.success("新增成功"),C(),h()}).finally(()=>u.value=!1)}})}function C(){g.visible=!1,Z()}function Z(){E.value.resetFields(),E.value.clearValidate(),n.id=void 0,n.sort=1,n.status=1}function $(s){const l=[s||M.value].join(",");if(!l){w.warning("请勾选删除项");return}ye.confirm("确认删除已选中的数据项?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{u.value=!0,Ge(l).then(()=>{w.success("删除成功"),h()}).finally(()=>u.value=!1)})}function ee(s){const l=s.id;l&&(N={id:l,name:s.name},v.value=!0,u.value=!0,ke().then(f=>{D.value=f.data,Je(l).then(({data:m})=>{const R=m;console.log("勾选权限",R),R.forEach(r=>F.value.setChecked(r,!0,!1))}).finally(()=>{u.value=!1})}))}function le(){const s=N.id;if(s){const l=F.value.getCheckedNodes(!1,!0).map(f=>f.value);u.value=!0,Ae(s,l).then(f=>{w.success("分配权限成功"),v.value=!1,h()}).finally(()=>{u.value=!1})}}return fe(()=>{k()}),(s,l)=>{const f=he,m=Oe,R=we,r=Ve,te=Ee,q=z,oe=Le,T=Ce,b=Re,L=xe,ae=Ze,ne=Se,se=Ue,ie=Te,ue=qe,x=Fe,re=Me,O=Ie,de=$e,pe=De,K=Be,me=J,_e=ze,P=Ne;return d(),A("div",el,[S("div",ll,[e(q,{ref_key:"queryFormRef",ref:U,model:a(p),inline:!0},{default:t(()=>[e(m,{prop:"keywords",label:"关键字"},{default:t(()=>[e(f,{modelValue:a(p).keywords,"onUpdate:modelValue":l[0]||(l[0]=o=>a(p).keywords=o),placeholder:"角色名称",clearable:"",onKeyup:ge(k,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),e(m,null,{default:t(()=>[e(r,{type:"primary",onClick:k},{default:t(()=>[e(R),i("搜索")]),_:1}),e(r,{onClick:h},{default:t(()=>[e(te),i("重置")]),_:1})]),_:1})]),_:1},8,["model"])]),e(ue,{shadow:"never"},{header:t(()=>[e(r,{type:"success",onClick:l[1]||(l[1]=o=>I())},{default:t(()=>[e(oe),i("新增")]),_:1}),e(r,{type:"danger",disabled:a(M).length===0,onClick:l[2]||(l[2]=o=>$())},{default:t(()=>[e(T),i("删除")]),_:1},8,["disabled"])]),default:t(()=>[Q((d(),c(se,{ref:"dataTableRef",data:a(B),onSelectionChange:X,"highlight-current-row":"",border:""},{default:t(()=>[e(b,{type:"selection",width:"55",align:"center"}),e(b,{label:"角色名称",prop:"name","min-width":"100"}),e(b,{label:"角色编码",prop:"code",width:"150"}),e(b,{label:"状态",align:"center",width:"100"},{default:t(o=>[o.row.status===1?(d(),c(L,{key:0,type:"success"},{default:t(()=>[i("正常")]),_:1})):(d(),c(L,{key:1,type:"info"},{default:t(()=>[i("禁用")]),_:1}))]),_:1}),e(b,{label:"排序",align:"center",width:"80",prop:"sort"}),e(b,{fixed:"right",label:"操作",width:"220"},{default:t(o=>[e(r,{type:"primary",size:"small",link:"",onClick:j=>ee(o.row)},{default:t(()=>[e(ae),i("分配权限 ")]),_:2},1032,["onClick"]),e(r,{type:"primary",size:"small",link:"",onClick:j=>I(o.row.id)},{default:t(()=>[e(ne),i("编辑 ")]),_:2},1032,["onClick"]),e(r,{type:"primary",size:"small",link:"",onClick:j=>$(o.row.id)},{default:t(()=>[e(T),i("删除 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[P,a(u)]]),a(y)>0?(d(),c(ie,{key:0,total:a(y),"onUpdate:total":l[3]||(l[3]=o=>G(y)?y.value=o:null),page:a(p).pageNum,"onUpdate:page":l[4]||(l[4]=o=>a(p).pageNum=o),limit:a(p).pageSize,"onUpdate:limit":l[5]||(l[5]=o=>a(p).pageSize=o),onPagination:k},null,8,["total","page","limit"])):ve("",!0)]),_:1}),e(K,{title:a(g).title,modelValue:a(g).visible,"onUpdate:modelValue":l[11]||(l[11]=o=>a(g).visible=o),width:"500px",onClose:C},{footer:t(()=>[S("div",tl,[e(r,{type:"primary",onClick:Y},{default:t(()=>[i("确 定")]),_:1}),e(r,{onClick:C},{default:t(()=>[i("取 消")]),_:1})])]),default:t(()=>[e(q,{ref_key:"roleFormRef",ref:E,model:a(n),rules:a(W),"label-width":"100px"},{default:t(()=>[e(m,{label:"角色名称",prop:"name"},{default:t(()=>[e(f,{modelValue:a(n).name,"onUpdate:modelValue":l[6]||(l[6]=o=>a(n).name=o),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),e(m,{label:"角色编码",prop:"code"},{default:t(()=>[e(f,{modelValue:a(n).code,"onUpdate:modelValue":l[7]||(l[7]=o=>a(n).code=o),placeholder:"请输入角色编码"},null,8,["modelValue"])]),_:1}),e(m,{label:"数据权限",prop:"dataScope"},{default:t(()=>[e(re,{modelValue:a(n).dataScope,"onUpdate:modelValue":l[8]||(l[8]=o=>a(n).dataScope=o)},{default:t(()=>[(d(),c(x,{key:0,label:"全部数据",value:0})),(d(),c(x,{key:1,label:"部门及子部门数据",value:1})),(d(),c(x,{key:2,label:"本部门数据",value:2})),(d(),c(x,{key:3,label:"本人数据",value:3}))]),_:1},8,["modelValue"])]),_:1}),e(m,{label:"状态",prop:"status"},{default:t(()=>[e(de,{modelValue:a(n).status,"onUpdate:modelValue":l[9]||(l[9]=o=>a(n).status=o)},{default:t(()=>[e(O,{label:1},{default:t(()=>[i("正常")]),_:1}),e(O,{label:0},{default:t(()=>[i("停用")]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(m,{label:"排序",prop:"sort"},{default:t(()=>[e(pe,{modelValue:a(n).sort,"onUpdate:modelValue":l[10]||(l[10]=o=>a(n).sort=o),"controls-position":"right",min:0,style:{width:"100px"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),e(K,{title:"【"+a(N).name+"】权限分配",modelValue:a(v),"onUpdate:modelValue":l[13]||(l[13]=o=>G(v)?v.value=o:null),width:"800px"},{footer:t(()=>[S("div",ol,[e(r,{type:"primary",onClick:le},{default:t(()=>[i("确 定")]),_:1}),e(r,{onClick:l[12]||(l[12]=o=>v.value=!1)},{default:t(()=>[i("取 消")]),_:1})])]),default:t(()=>[Q((d(),c(_e,{"max-height":"600px"},{default:t(()=>[e(me,{ref_key:"menuRef",ref:F,"node-key":"value","show-checkbox":"",data:a(D),"default-expand-all":!0},{default:t(({data:o})=>[i(be(o.label),1)]),_:1},8,["data"])]),_:1})),[[P,a(u)]])]),_:1},8,["title","modelValue"])])}}});export{Vl as default};
